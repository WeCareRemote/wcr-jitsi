FROM tiangolo/uvicorn-gunicorn-fastapi:python3.9

WORKDIR /app

COPY . /app

RUN pip install --upgrade pip && pip install --no-cache-dir --upgrade -r /app/requirements.txt

ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG DB_HOST
ARG DB_DATABASE
ARG DB_PASSWORD
ARG DB_USERNAME
ARG DB_PORT
ARG STORAGE_HOST
ARG GREYT_HOST
ARG APP_MODULE
ARG RECORDS_DIR
ARG APP_MODE
ARG RECORDS_HANDLER_TOKEN
ARG S3_BUCKET

ENV AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID} \
    AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY} \
    DB_HOST=${DB_HOST} \
    DB_DATABASE=${DB_DATABASE} \
    DB_PASSWORD=${DB_PASSWORD} \
    DB_USERNAME=${DB_USERNAME} \
    DB_PORT=${DB_PORT} \
    STORAGE_HOST=${STORAGE_HOST} \
    GREYT_HOST=${GREYT_HOST} \
    APP_MODULE=${APP_MODULE} \
    RECORDS_DIR=${RECORDS_DIR} \
    APP_MODE=${APP_MODE} \
    RECORDS_HANDLER_TOKEN=${RECORDS_HANDLER_TOKEN} \
    S3_BUCKET=${S3_BUCKET}